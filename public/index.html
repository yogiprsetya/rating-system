<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcome to Firebase Hosting</title>

  <style>
  .rate {
    padding: 0;
    display: inline-block;
  }

  .rate button {
    padding: 0;
    line-height: 0;
    background: none;
    border: 0;
    cursor: pointer
  }

  .rate legend {
    margin-bottom: 10px;
  }

  .rate button svg {
    fill: lightgrey
  }

  .rate label {
    font-weight: bold;
    font-size: 20px;
    margin-left: 5px;
    vertical-align: text-bottom;
  }
  </style>
</head>
<body>


  <fieldset class="rate">
    <legend>Bantu rate ya ..</legend>
    <button onclick="javascript: rate(1)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.94 49.94" width="24"><path d="M48.86 22.73a3.56 3.56 0 00.9-3.67 3.56 3.56 0 00-2.89-2.44l-12.1-1.76c-.5-.07-.95-.4-1.18-.86l-5.4-10.96c-.62-1.23-1.85-2-3.22-2s-2.6.77-3.21 2L16.36 14c-.24.47-.68.79-1.2.86l-12.1 1.76a3.56 3.56 0 00-2.88 2.44 3.56 3.56 0 00.9 3.67l8.75 8.53c.38.36.55.89.46 1.4L8.22 44.7A3.5 3.5 0 009 47.6a3.62 3.62 0 004.42.88l10.81-5.69a1.62 1.62 0 011.48 0l10.81 5.69a3.54 3.54 0 004.41-.87 3.5 3.5 0 00.79-2.9l-2.07-12.05c-.09-.51.08-1.04.46-1.4l8.75-8.53z"/></svg>
    </button>

    <button onclick="javascript: rate(2)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.94 49.94" width="24"><path d="M48.86 22.73a3.56 3.56 0 00.9-3.67 3.56 3.56 0 00-2.89-2.44l-12.1-1.76c-.5-.07-.95-.4-1.18-.86l-5.4-10.96c-.62-1.23-1.85-2-3.22-2s-2.6.77-3.21 2L16.36 14c-.24.47-.68.79-1.2.86l-12.1 1.76a3.56 3.56 0 00-2.88 2.44 3.56 3.56 0 00.9 3.67l8.75 8.53c.38.36.55.89.46 1.4L8.22 44.7A3.5 3.5 0 009 47.6a3.62 3.62 0 004.42.88l10.81-5.69a1.62 1.62 0 011.48 0l10.81 5.69a3.54 3.54 0 004.41-.87 3.5 3.5 0 00.79-2.9l-2.07-12.05c-.09-.51.08-1.04.46-1.4l8.75-8.53z"/></svg>
    </button>

    <button onclick="javascript: rate(3)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.94 49.94" width="24"><path d="M48.86 22.73a3.56 3.56 0 00.9-3.67 3.56 3.56 0 00-2.89-2.44l-12.1-1.76c-.5-.07-.95-.4-1.18-.86l-5.4-10.96c-.62-1.23-1.85-2-3.22-2s-2.6.77-3.21 2L16.36 14c-.24.47-.68.79-1.2.86l-12.1 1.76a3.56 3.56 0 00-2.88 2.44 3.56 3.56 0 00.9 3.67l8.75 8.53c.38.36.55.89.46 1.4L8.22 44.7A3.5 3.5 0 009 47.6a3.62 3.62 0 004.42.88l10.81-5.69a1.62 1.62 0 011.48 0l10.81 5.69a3.54 3.54 0 004.41-.87 3.5 3.5 0 00.79-2.9l-2.07-12.05c-.09-.51.08-1.04.46-1.4l8.75-8.53z"/></svg>
    </button>

    <button onclick="javascript: rate(4)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.94 49.94" width="24"><path d="M48.86 22.73a3.56 3.56 0 00.9-3.67 3.56 3.56 0 00-2.89-2.44l-12.1-1.76c-.5-.07-.95-.4-1.18-.86l-5.4-10.96c-.62-1.23-1.85-2-3.22-2s-2.6.77-3.21 2L16.36 14c-.24.47-.68.79-1.2.86l-12.1 1.76a3.56 3.56 0 00-2.88 2.44 3.56 3.56 0 00.9 3.67l8.75 8.53c.38.36.55.89.46 1.4L8.22 44.7A3.5 3.5 0 009 47.6a3.62 3.62 0 004.42.88l10.81-5.69a1.62 1.62 0 011.48 0l10.81 5.69a3.54 3.54 0 004.41-.87 3.5 3.5 0 00.79-2.9l-2.07-12.05c-.09-.51.08-1.04.46-1.4l8.75-8.53z"/></svg>
    </button>

    <button onclick="javascript: rate(5)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.94 49.94" width="24"><path d="M48.86 22.73a3.56 3.56 0 00.9-3.67 3.56 3.56 0 00-2.89-2.44l-12.1-1.76c-.5-.07-.95-.4-1.18-.86l-5.4-10.96c-.62-1.23-1.85-2-3.22-2s-2.6.77-3.21 2L16.36 14c-.24.47-.68.79-1.2.86l-12.1 1.76a3.56 3.56 0 00-2.88 2.44 3.56 3.56 0 00.9 3.67l8.75 8.53c.38.36.55.89.46 1.4L8.22 44.7A3.5 3.5 0 009 47.6a3.62 3.62 0 004.42.88l10.81-5.69a1.62 1.62 0 011.48 0l10.81 5.69a3.54 3.54 0 004.41-.87 3.5 3.5 0 00.79-2.9l-2.07-12.05c-.09-.51.08-1.04.46-1.4l8.75-8.53z"/></svg>
    </button>

    <label></label>
  </fieldset>

  <script id="AggregateRating" type="application/ld+json"></script>

<script>
  function fillStar(stars) {
    for (var i = 0; i < stars; i++) {
      document.querySelectorAll(".rate svg")[i].style.fill = "gold";
    }
  }

  function getRate(rating) {
    fetch('https://us-central1-ratingsystem-d54ce.cloudfunctions.net/app/rating/seni-lukis', {
      method: 'GET',
      async: false,
    })
    .then((res) => res.json())
    .then(data => {
      let avg = data.reduce((a, b) => a + b, 0) / data.length
      console.log(data)

      if (data.length !== 0) {
        document.querySelector(".rate label").innerHTML = avg.toFixed(2) + "/" + data.length
        document.getElementById("AggregateRating").innerHTML = `
        {
          "@context": "https://schema.org/",
          "@type": "CreativeWorkSeries",
          "name": "Legal Seafood",
          "AggregateRating": {
          "@type": "AggregateRating",
              "ratingValue": ${avg},
              "bestRating": ${Math.max(...data)},
              "reviewCount": ${data.length}
            }
        }`
      }      

      if (avg < 2) {
        fillStar(1)
      } else if (avg < 3) {
        fillStar(2)
      } else if (avg < 4) {
        fillStar(3)
      } else if (avg < 5) {
        fillStar(4)
      } else {
        fillStar(5)
      }
    })
    .catch((err) => console.log(err))
  }
  window.onload = getRate;
  
  function rate(rating) {
    fetch('https://us-central1-ratingsystem-d54ce.cloudfunctions.net/app/rate', {
      method: 'POST',
      async: false,
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        slug: 'seni-lukis',
        rate: rating
      })
    })
    .then((res) => {
      document.querySelector(".rate legend").innerHTML = "Terimakasih ..";
    })
    .catch((err) => console.log(err))
  }
</script>

</body>
</html>
